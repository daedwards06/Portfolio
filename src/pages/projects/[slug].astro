---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async () => {
  const projects = await getCollection('projects');
  return projects.map((project) => {
    const slug = project.id.replace(/\.[^/.]+$/, '');
    return {
      params: { slug },
      props: { project, slug },
    };
  });
}) satisfies GetStaticPaths;

const { project, slug } = Astro.props;
const { Content } = await render(project);
---

<BaseLayout
  title={project.data.title}
  description={`Case study: ${project.data.title}`}
  path={`/projects/${slug}`}
>
  <header class="header">
    <h1>{project.data.title}</h1>
    {project.data.tags.length > 0 && (
      <p class="muted">{project.data.tags.join(' Â· ')}</p>
    )}
    <div class="btnrow">
      {project.data.links?.demo && (
        <a class="btn primary" href={project.data.links.demo} target="_blank" rel="noreferrer">
          Live demo
        </a>
      )}
      {project.data.links?.repo && (
        <a class="btn" href={project.data.links.repo} target="_blank" rel="noreferrer">
          Repository
        </a>
      )}
    </div>
  </header>

  <article class="card">
    <Content />
  </article>
</BaseLayout>
